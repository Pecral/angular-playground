<html>

<head>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic'
    rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="https://swisnl.github.io/jQuery-contextMenu/css/screen.css" type="text/css" />
  <link rel="stylesheet" href="https://swisnl.github.io/jQuery-contextMenu/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="https://swisnl.github.io/jQuery-contextMenu/css/theme-fixes.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/github.min.css">
  <link href="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.css" rel="stylesheet" type="text/css" />

  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.fancytree/2.23.0/jquery.fancytree-all.js"></script>
  <script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.contextMenu.js" type="text/javascript"></script>

  <!--<script src="https://swisnl.github.io/jQuery-contextMenu/dist/jquery.ui.position.min.js" type="text/javascript"></script>-->

  <!--<script src="https://swisnl.github.io/jQuery-contextMenu/js/main.js" type="text/javascript"></script>-->





</head>

<body>
  <table id="tree">
    <colgroup>
      <col width="30px">
      <col width="700px">
      <col width="30px">
      <col width="30px">
      <col width="30px">
      <col width="50px">
    </colgroup>
    <thead>
      <tr>
        <th></th>
        <th>ServiceGroup / Element</th>
        <th>RT</th>
        <th>DL</th>
        <th>EoD</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
      <!-- Define a row template for all invariant markup: -->
      <tr>
        <td class="alignCenter"></td>
        <td></td>
        <td class="alignCenter"><input name="cb_Realtime" type="checkbox"></td>
        <td class="alignCenter"><input name="cb_Delayed" type="checkbox"></td>
        <td class="alignCenter"><input name="cb_EndOfDay" type="checkbox"></td>
        <td>
          <select name="sel1" id="">
                            <option value="REALTIME">Realtime</option>
                            <option value="DELAYED">Delayed</option>
                            <option value="END_OF_DAY">End of Day</option>
                        </select>
        </td>
      </tr>
    </tbody>
  </table>

  <script type="text/javascript">
    $(function () {
      var jsonData = [{
        "title": "ServiceGroup A",
        "expanded": false,
        "folder": true,
        "children": [{
          "title": "ServiceGroup AA",
          "expanded": false,
          "folder": true,
          "children": []
        }, {
          "title": "ServiceGroup AB",
          "expanded": false,
          "folder": true,
          "children": [{
            "title": "ServiceGroup ABA",
            "expanded": false,
            "folder": true,
            "children": [{
              "title": "Xetra European Stars Level 1"
            }]
          }]
        }]
      }, {
        "title": "",
        "expanded": false,
        "folder": true,
        "children": []
      }, {
        "title": "SoftwareService",
        "expanded": false,
        "folder": true,
        "children": []
      }];

      $("#tree").fancytree({
        checkbox: true,
        quicksearch: true,
        selectMode: 3, // 1:single, 2:multi, 3:multi-hier
        extensions: ["table", "gridnav", "childcounter"],

        source: jsonData,
        // source: {
        //   url: "http://localhost:8611/de/DeviceTemplate/GetDeviceTemplateElementTree",
        //   type: "post",
        //   data: ({
        //     deviceTemplateId: 1
        //   }),
        //   dataType: "json",
        // },

        table: {
          indentation: 20,
          nodeColumnIdx: 1,
          checkboxColumnIdx: 0
        },

        gridnav: {
          autofocusInput: false,
          handleCursorKeys: true
        },

        childcounter: {
          deep: false,
          hideZeros: true,
          hideExpanded: true
        },

        createNode: function (event, data) {
          var node = data.node,
            $tdList = $(node.tr).find(">td");

          // Span the remaining columns if it's a folder.
          // We can do this in createNode instead of renderColumns, because
          // the `isFolder` status is unlikely to change later
          if (node.isFolder()) {
            $tdList.eq(1)
              .prop("colspan", 6)
              .nextAll().remove();
          }

          //if (node.data.serviceGroupType === "SINGLE_SELECT") {
          //    node.checkbox = false;
          //}
        },

        renderColumns: function (event, data) {
          var node = data.node,
            $tdList = $(node.tr).find(">td");

          // (Index #0 is rendered by fancytree by adding the checkbox)
          // Set column #1 info from node data:
          //$tdList.eq(1).text(node.getIndexHier());
          // (Index #2 is rendered by fancytree)
          // Set column #3 info from node data:
          $tdList.eq(1).find("input").val(node.key);
          $tdList.eq(2).find("input").val(node.data.foo);

          // Static markup (more efficiently defined as html row template):
          // $tdList.eq(3).html("<input type='input' value='" + "" + "'>");
          // ...
        },

        activate: function (event, data) {
          var node = data.node;

          //debugger;

          if (node.isFolder()) {
            $('#tfp_serviceGroupType').val(node.data.serviceGroupType);
            $('#tfp_preselect').prop('checked', node.data.isSelectedByDefault);
            $('#tfp_visibility').prop('checked', node.data.isVisible);
            $('#tfp_required').prop('checked', node.data.isRequired);

            $('#treeFolderProperties').show();
          } else {
            $('#treeFolderProperties').hide();
          }
        },

      });

      $('#tfp_serviceGroupType').change(function () {
        $(this).find(":selected").each(function () {
          console.log('tfp_serviceGroupType: current value -> ' + $(this).val());
        })
      });

      $('#tfp_preselect').change(function () {
        var checked = $(this).is(":checked");
        console.log('tfp_preselect: current value -> ' + checked);
      });

      $('#tfp_visibility').change(function () {
        var checked = $(this).is(":checked");
        console.log('tfp_preselect: current value -> ' + checked);
      });

      $('#tfp_required').change(function () {
        var checked = $(this).is(":checked");
        console.log('tfp_preselect: current value -> ' + checked);
      });
    });


      $.contextMenu({
        selector: "#tree span.fancytree-title",

        items: {

          "type": {
            name: "Auswahltyp",
            type: 'select',
            options: {
              'SINGLE_SELECT': 'Einzelauswahl',
              'MULTI_SELECT': 'Mehrfachauswahl',
              'ALL_OR_NONE': 'Alle oder keins',
              'BASE_PACKAGE': 'Basispaket',
            },
            selected: 'MULTI_SELECT'
          },

          "isRequired": {
            name: "Pflicht",
            type: 'checkbox',
            selected: true
          },

          "isSelectedByDefault": {
            name: "Vorselektiert",
            type: 'checkbox',
            selected: true
          },

          "isVisible": {
            name: "Sichtbar",
            type: 'checkbox',
            selected: true
          },

        },

        //events: {
        //    show: function (opt) {
        //        var $this = this;
        //        $.contextMenu.setInputValues(opt, $this.data());
        //    },
        //    hide: function (opt) {
        //        var $this = this;
        //        $.contextMenu.getInputValues(opt, $this.data());
        //    }
        //},

        callback: function (itemKey, opt) {
          var node = $.ui.fancytree.getNode(opt.$trigger);
          alert("select " + itemKey + " on " + node);
        }

      });


  </script>

</body>

</html>
